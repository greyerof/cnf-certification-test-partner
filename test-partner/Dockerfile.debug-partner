FROM registry.access.redhat.com/ubi8/ubi:8.7 as podman-builder
RUN \
	dnf update --assumeyes --disableplugin=subscription-manager \
	&& dnf install --assumeyes --disableplugin=subscription-manager \
		git \
		make \
		golang \
		gpgme-devel \
		libseccomp-devel \
		libassuan-devel \
		python3 \
    && git clone https://github.com/containers/podman.git \
	&& cd podman \
	&& git checkout v4.4.0 \
	&& make

FROM registry.access.redhat.com/ubi8/ubi:8.7
RUN \
	dnf update --assumeyes --disableplugin=subscription-manager \
	&& dnf install --assumeyes --disableplugin=subscription-manager \
		ethtool-2:5.13 \
		iproute-5.18.0 \
		iptables-1.8.4 \
		iputils-20180629 \
		jq-1.6 \
		libselinux-utils-2.9 \
		net-tools-2.0 \
		nftables-1:0.9.3 \
		pciutils-3.7.0 \
		procps-ng-3.3.15 \
		util-linux \
	&& dnf clean all --assumeyes --disableplugin=subscription-manager \
	&& rm -fr /var/cache/yum \
	&& mkdir /root/podman
COPY --from=podman-builder /podman/bin/podman /root/podman/
VOLUME ["/host"]
